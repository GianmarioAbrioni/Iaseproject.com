<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="Discover IASE Token, the native currency of the IASE autonomous ecosystem. Learn how to add it to MetaMask and explore its future utility in space AI infrastructure." name="description"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta name="theme-color" content="#121212">
  <meta name="author" content="IASE Project">
  
  <!-- Open Graph / Social Media Meta Tags -->
  <meta property="og:title" content="IASE Project - Token">
  <meta property="og:description" content="Discover IASE Token, the native currency of the IASE autonomous ecosystem. Learn how to add it to MetaMask and explore its future utility in space AI infrastructure.">
  <meta property="og:image" content="images/iase-token-logo.png">
  <meta property="og:url" content="https://iaseproject.com/token.html">
  <meta property="og:type" content="website">
  
  <!-- Favicon -->
  <link href="favicon.png" rel="icon" type="image/png"/>
  <link href="favicon.png" rel="apple-touch-icon"/>
  <link href="favicon.png" rel="icon" sizes="96x96" type="image/png"/>
  
  <title>IASE Project - Token</title>
  
  <!-- Stylesheets -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
  <link href="menu.css" rel="stylesheet"/>
  <link href="styles.css" rel="stylesheet"/>
  <link href="css/parallax.css" rel="stylesheet"/>
  <link href="css/token-page.css" rel="stylesheet"/>
  
  <!-- Web3 Script -->
  <!-- Custom Token Page Styles -->
  <style>
    .step {
      margin-bottom: 2rem;
      border-left: 4px solid var(--primary);
      padding-left: 1rem;
      transition: all 0.3s ease;
    }
    .step.complete {
      border-color: #555;
      color: #999;
    }
    .step.now {
      background-color: #1d1d1d;
      border-left: 4px solid #00ffcc;
      padding: 1rem;
      border-radius: 6px;
    }
    .token-card {
      background-color: var(--bg-card);
      border-radius: 10px;
      padding: 30px;
      margin-top: 40px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }
    .token-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
    }
    .token-logo {
      max-width: 150px;
      margin-bottom: 20px;
      transition: all 0.3s ease;
    }
    .token-logo:hover {
      transform: scale(1.05);
    }
    .metamask-btn {
      padding: 10px 20px;
      background-color: #f0b90b;
      color: black;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .metamask-btn:hover {
      background-color: #e0aa0b;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(240, 185, 11, 0.3);
    }
    .buy-btn {
      padding: 10px 20px;
      background-color: #4caf50;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .buy-btn:hover {
      background-color: #3d9140;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
    }
    .connect-btn {
      padding: 10px 15px;
      background-color: orange;
      color: black;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .connect-btn:hover {
      background-color: #e69500;
      transform: translateY(-2px);
    }
    .token-info-row {
      margin-bottom: 10px;
    }
    .token-info-label {
      font-weight: bold;
      color: var(--text-muted);
    }
    .token-info-value {
      color: var(--text-light);
    }
    .token-description {
      max-width: 700px;
      margin: auto;
      font-size: 18px;
      line-height: 1.6;
    }
    #presaleForm input {
      padding: 12px;
      width: 100%;
      max-width: 300px;
      margin: 10px auto;
      border-radius: 5px;
      border: 1px solid var(--bg-card-hover);
      background-color: var(--bg-card);
      color: var(--text-light);
      transition: all 0.3s ease;
    }
    #presaleForm input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 191, 255, 0.2);
      outline: none;
    }
    /* Range modal styling */
    #rangeModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.8);
      z-index: 1000;
    }
    .range-modal-content {
      background: #fff;
      color: #000;
      padding: 25px;
      max-width: 400px;
      margin: 100px auto;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .range-modal-btn {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #ff9800;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .range-modal-btn:hover {
      background-color: #e68a00;
      transform: translateY(-2px);
    }
  </style>
</head>

<body>
  <!-- Main Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3 sticky-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <i class="ri-home-3-line"></i> IASE üõ∞Ô∏è
      </a>
      <button class="navbar-toggler" data-bs-target="#navbarContent" data-bs-toggle="collapse" type="button" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="projectDropdown" role="button" aria-expanded="false">
              Project
            </a>
            <ul class="dropdown-menu" aria-labelledby="projectDropdown">
              <li><a class="dropdown-item" href="project-overview.html">Overview</a></li>
              <li><a class="dropdown-item" href="technology.html">Technology &amp; Applications</a></li>
              <li><a class="dropdown-item" href="behind.html">Behind IASE</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle active" data-bs-toggle="dropdown" href="#" id="web3Dropdown" role="button" aria-expanded="false">
              Web3
            </a>
            <ul class="dropdown-menu" aria-labelledby="web3Dropdown">
              <li><a class="dropdown-item" href="web3.html">Web3 Integration</a></li>
              <li><a class="dropdown-item active" href="token.html">Token</a></li>
              <li><a class="dropdown-item" href="nft.html">NFT Collection</a></li>
              <li><a class="dropdown-item" href="staking.html">NFT Staking Platform</a></li>
              <li><a class="dropdown-item" href="roadmap.html">Roadmap</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" id="resourcesDropdown" role="button" aria-expanded="false">
              Resources
            </a>
            <ul class="dropdown-menu" aria-labelledby="resourcesDropdown">
              <li><a class="dropdown-item" href="articles.html">Articles</a></li>
              <li><a class="dropdown-item" href="publication.html">Publications</a></li>
              <li><a class="dropdown-item" href="contact.html">Contact &amp; Documents</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  <!-- Wallet Status Styles -->
  <style>
    .wallet-status {
      display: flex;
      align-items: center;
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.75);
    }
    
    .connection-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 0.5rem;
    }
    
    .connected {
      background-color: #4caf50;
      box-shadow: 0 0 5px #4caf50;
    }
    
    .disconnected {
      background-color: #ff5252;
      box-shadow: 0 0 5px #ff5252;
    }
  </style>

  <!-- Header Area -->
  <header class="header-area fade-in">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-12 text-center">
          <h1 class="site-title">IASE Token</h1>
          <p class="site-description">Utility, Pre-Sale and Technical Details of the IASE Crypto Asset</p>
        </div>
      </div>
    </div>
  </header>
<script>
function toggleMenu() {
    var menu = document.getElementById('menu');
    menu.classList.toggle('show');
}
</script>

<!-- SEZIONE CENTRALE TOKEN -->
<div class="token-section py-5 text-center parallax-section">
  <div class="space-background" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(125deg, #050520 0%, #0B0B30 100%); z-index: 0; pointer-events: none;">
    <!-- Stars will be added dynamically by space-background.js -->
    <div class="space-fog"></div>
  </div>
  <div class="container position-relative" style="z-index: 2;">
    <!-- LOGO -->
    <div class="logo-container">
      <img class="token-logo" alt="IASE Token Logo" src="images/iase-token-logo.png"/>
    </div>
    
    <!-- DESCRIZIONE -->
    <h2 class="section-title mb-4">IASE Token</h2>
    <p class="token-description mb-5">
      IASE Token is the core currency of the IASE autonomous ecosystem, enabling future interactions between AI units and decentralized infrastructures in space and beyond. It is now live on the BNB Smart Chain.
    </p>
    
    <!-- ADD TO METAMASK -->
    <div class="metamask-container my-5">
      <button onclick="addTokenToMetaMask()" class="metamask-btn">
        <i class="ri-wallet-3-line me-2"></i> Add IASE Token to MetaMask
      </button>
      <p id="metamask-status" class="mt-3"></p>
      <p class="text-muted mt-3 fst-italic small">
        * Note: Only MetaMask supports automatic token import.<br>
        If you're using a different wallet, you'll need to add the token manually.<br>
        You can find a simple guide in the FAQ section at the bottom of this page.
      </p>
    </div>
  </div>
</div>
<script>
  async function addTokenToMetaMask() {
    if (typeof window.ethereum !== 'undefined' && window.ethereum.isMetaMask) {
      try {
        const wasAdded = await window.ethereum.request({
          method: 'wallet_watchAsset',
          params: {
            type: 'ERC20',
            options: {
              address: '0x5A170D59ae8B851DC4DD0D14cC89E5fE541752CE',
              symbol: 'IASE',
              decimals: 18,
              image: 'https://iaseproject.com/images/iase-token-logo.png',
            },
          },
        });

        document.getElementById("metamask-status").innerText = wasAdded
          ? "IASE Token successfully added to MetaMask."
          : "Token import cancelled by user.";
      } catch (error) {
        console.error(error);
        document.getElementById("metamask-status").innerText = "Error: " + error.message;
      }
    } else {
      document.getElementById("metamask-status").innerHTML = `
  MetaMask is not available or not connected.<br>
  Make sure you are using a browser with the MetaMask extension enabled, or the MetaMask in-app browser.<br>
  <a href="https://metamask.io/download.html" target="_blank" style="color: #f0b90b;">Click here to install MetaMask or open the app.</a>
`;
    }
  }
</script>
<!-- INFO TOKEN -->
<div class="token-card token-info-card">
  <div class="container">
    <h2 class="section-title mb-4">Token Information</h2>
    
    <div class="row token-info-row">
      <div class="col-md-4 col-sm-5 token-info-label">Contract:</div>
      <div class="col-md-8 col-sm-7 token-info-value">
        <a href="https://bscscan.com/token/0x5A170D59ae8B851DC4DD0D14cC89E5fE541752CE" class="text-primary" target="_blank" rel="noopener">
          0x5A17...52CE
        </a>
        <button onclick="copyToClipboard()" class="btn btn-sm btn-link p-0 ms-2">
          <i class="ri-file-copy-line"></i>
        </button>
      </div>
    </div>
    
    <div class="row token-info-row">
      <div class="col-md-4 col-sm-5 token-info-label">Network:</div>
      <div class="col-md-8 col-sm-7 token-info-value">BNB Smart Chain</div>
    </div>
    
    <div class="row token-info-row">
      <div class="col-md-4 col-sm-5 token-info-label">Symbol:</div>
      <div class="col-md-8 col-sm-7 token-info-value">IASE</div>
    </div>
    
    <div class="row token-info-row">
      <div class="col-md-4 col-sm-5 token-info-label">Decimals:</div>
      <div class="col-md-8 col-sm-7 token-info-value">18</div>
    </div>
    
    <div class="row token-info-row">
      <div class="col-md-4 col-sm-5 token-info-label">Total Supply:</div>
      <div class="col-md-8 col-sm-7 token-info-value">1,000,000,000 IASE</div>
    </div>
    
    <div class="token-links mt-4">
      <a href="https://poocoin.app/tokens/0x5A170D59ae8B851DC4DD0D14cC89E5fE541752CE" class="btn btn-outline-primary me-3" target="_blank" rel="noopener">
        <i class="ri-bar-chart-line me-2"></i> View on Poocoin
      </a>
      <a href="https://bscscan.com/token/0x5A170D59ae8B851DC4DD0D14cC89E5fE541752CE" class="btn btn-outline-primary" target="_blank" rel="noopener">
        <i class="ri-search-line me-2"></i> View on BscScan
      </a>
    </div>
  </div>
</div>

<!-- TOKENOMICS SECTION -->
<div class="token-card tokenomics-card">
  <div class="container">
    <h2 class="section-title mb-4">Tokenomics</h2>
    
    <div class="row align-items-center">
      <div class="col-lg-6">
        <div class="tokenomics-chart-container mb-4 mb-lg-0">
          <canvas id="tokenomicsChart"></canvas>
        </div>
      </div>
      
      <div class="col-lg-6">
        <div class="tokenomics-legend">
          <h3 class="mb-3">Token Distribution</h3>
          <p class="mb-4">IASE Token distribution is designed to support the project's long-term vision while ensuring fair participation opportunities.</p>
          
          <div class="tokenomics-item">
            <div class="tokenomics-color" style="background-color: rgba(0, 191, 255, 0.8);"></div>
            <div class="tokenomics-info">
              <h4 class="tokenomics-title">Pre-sale</h4>
              <p class="tokenomics-value" id="presaleValue">15%</p>
              <p class="tokenomics-tokens">150,000,000 IASE</p>
            </div>
          </div>
          
          <div class="tokenomics-item">
            <div class="tokenomics-color" style="background-color: rgba(75, 192, 192, 0.8);"></div>
            <div class="tokenomics-info">
              <h4 class="tokenomics-title">Liquidity Pool</h4>
              <p class="tokenomics-value" id="liquidityValue">20%</p>
              <p class="tokenomics-tokens">200,000,000 IASE</p>
            </div>
          </div>
          
          <div class="tokenomics-item">
            <div class="tokenomics-color" style="background-color: rgba(153, 102, 255, 0.8);"></div>
            <div class="tokenomics-info">
              <h4 class="tokenomics-title">Staking Rewards</h4>
              <p class="tokenomics-value" id="stakingValue">25%</p>
              <p class="tokenomics-tokens">250,000,000 IASE</p>
            </div>
          </div>
          
          <div class="tokenomics-item">
            <div class="tokenomics-color" style="background-color: rgba(255, 159, 64, 0.8);"></div>
            <div class="tokenomics-info">
              <h4 class="tokenomics-title">Team & Development</h4>
              <p class="tokenomics-value" id="teamValue">15%</p>
              <p class="tokenomics-tokens">150,000,000 IASE</p>
            </div>
          </div>
          
          <div class="tokenomics-item">
            <div class="tokenomics-color" style="background-color: rgba(255, 99, 132, 0.8);"></div>
            <div class="tokenomics-info">
              <h4 class="tokenomics-title">Ecosystem & Partnerships</h4>
              <p class="tokenomics-value" id="ecosystemValue">15%</p>
              <p class="tokenomics-tokens">150,000,000 IASE</p>
            </div>
          </div>
          
          <div class="tokenomics-item">
            <div class="tokenomics-color" style="background-color: rgba(54, 162, 235, 0.8);"></div>
            <div class="tokenomics-info">
              <h4 class="tokenomics-title">Reserve</h4>
              <p class="tokenomics-value" id="reserveValue">10%</p>
              <p class="tokenomics-tokens">100,000,000 IASE</p>
            </div>
          </div>
        </div>
        
        <div class="tokenomics-note mt-4">
          <p><small class="text-muted">* Please refer to the <a href="pdf/iase_token_whitepaper.pdf" target="_blank">official whitepaper</a> for detailed token allocation and vesting information.</small></p>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  function copyToClipboard() {
    const contractAddress = "0x5A170D59ae8B851DC4DD0D14cC89E5fE541752CE";
    navigator.clipboard.writeText(contractAddress).then(() => {
      alert("IASE contract address copied to clipboard!");
    });
  }
</script>
<!-- PREVENDITA -->
<div class="token-card presale-card">
  <div class="container">
    <!-- Improved Pre-Sale Header Section with Highlight Effect -->
    <div class="presale-header text-center mb-5">
      <div class="presale-highlight">
        <h2 class="section-title mb-3">Pre-Sale is Live</h2>
        <div class="presale-underline"></div>
      </div>
      <p class="lead mt-4">
        Join the IASE journey early by purchasing tokens directly through the official smart contract form before the public listing expands!
      </p>
    </div>
    
    <!-- Improved Stats Cards with Better Visual Hierarchy -->
    <div class="row presale-stats mb-5">
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="presale-stat-card">
          <div class="stat-icon">
            <i class="ri-exchange-dollar-line"></i>
          </div>
          <h4 class="stat-label">Conversion Rate</h4>
          <p class="stat-value">0.1 BNB = 100,000 IASE</p>
        </div>
      </div>
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="presale-stat-card">
          <div class="stat-icon">
            <i class="ri-scales-3-line"></i>
          </div>
          <h4 class="stat-label">Purchase Limit</h4>
          <p class="stat-value">Min 0.05 BNB ‚Äì Max 10 BNB</p>
        </div>
      </div>
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="presale-stat-card">
          <div class="stat-icon">
            <i class="ri-funds-box-line"></i>
          </div>
          <h4 class="stat-label">Soft Cap</h4>
          <p class="stat-value">25 BNB</p>
        </div>
      </div>
      <div class="col-md-6 col-lg-3 mb-4">
        <div class="presale-stat-card">
          <div class="stat-icon">
            <i class="ri-bar-chart-box-line"></i>
          </div>
          <h4 class="stat-label">Hard Cap</h4>
          <p class="stat-value">150 BNB</p>
        </div>
      </div>
    </div>
    
    <!-- Improved Purchase Container with Card Visual -->
    <div class="buy-tokens-container">
      <div class="buy-tokens-card">
        <div class="buy-tokens-header">
          <h3><i class="ri-shopping-cart-2-line me-2"></i> Buy Tokens</h3>
        </div>
        <div class="buy-tokens-body">
          <p class="mb-4">Connect your wallet and purchase IASE directly by entering the amount of BNB you want to spend. Tokens will be instantly sent to your wallet.</p>
          
          <!-- WALLET CONNECT + FORM -->
          <div id="wallet-interface" class="d-flex flex-column align-items-center">
            <button id="connectButtonBNB" class="connect-btn mb-3" data-network="bnb">
              <i class="ri-wallet-3-line me-2"></i> Connect BNB Wallet
            </button>
            <div id="connection-status" style="display: none; margin-bottom: 1rem; text-align: center; font-size: 0.9rem;"></div>
            
            <!-- Network Warning -->
            <div id="wrong-network-alert" class="alert alert-warning wallet-wrong-network d-none" style="font-size: 0.9rem; margin-bottom: 15px;">
              <i class="ri-alert-line me-1"></i>
              <span>To purchase IASE Tokens, you need to be on the BNB Smart Chain network.</span>
              <button id="switch-network-btn" class="btn btn-sm btn-warning mt-2 switch-network-btn" data-chain="0x38" onclick="switchToBscNetwork()">Switch to BNB Chain</button>
            </div>
            
            <div id="walletInfo" class="wallet-info mb-4" style="display: none;">
              <div class="wallet-info-content">
                <i class="ri-checkbox-circle-line me-2 text-success"></i>
                Wallet connected: <span id="shortWallet" class="wallet-address"></span>
              </div>
            </div>
            
            <form id="presaleForm" class="presale-form" style="display: none;">
              <div class="form-group mb-4">
                <label for="bnbAmount" class="form-label">Amount in BNB (min 0.05 ‚Äì max 10):</label>
                <div class="input-with-icon">
                  <i class="ri-money-dollar-circle-line input-icon"></i>
                  <input 
                    id="bnbAmount" 
                    class="form-control"
                    type="number" 
                    placeholder="Enter amount in BNB" 
                    min="0.05" 
                    max="10" 
                    step="0.01" 
                    required
                    oninvalid="return false;"
                  />
                </div>
              </div>
              
              <div id="estimate" class="token-estimate my-3" style="display: none;">
                <div class="estimate-content">
                  <i class="ri-coins-line me-2"></i>
                  <span id="estimateText">You will receive: <strong>0 IASE</strong></span>
                </div>
              </div>
              
              <button type="submit" class="buy-btn w-100">
                <i class="ri-shopping-cart-2-line me-2"></i> Buy IASE Tokens
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Enhanced Pre-Sale Section Styling */
.presale-header {
  position: relative;
  padding: 10px 0;
}

.presale-highlight {
  position: relative;
  display: inline-block;
}

.presale-underline {
  height: 4px;
  width: 100px;
  background: linear-gradient(90deg, var(--primary), rgba(0, 191, 255, 0.3));
  margin: 0 auto;
  border-radius: 2px;
}

.presale-stat-card {
  background: rgba(30, 40, 60, 0.4);
  border-radius: 12px;
  padding: 20px;
  height: 100%;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.05);
  text-align: center;
}

.presale-stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
  background: rgba(30, 40, 60, 0.6);
  border-color: rgba(0, 191, 255, 0.2);
}

.stat-icon {
  font-size: 36px;
  color: var(--primary);
  margin-bottom: 15px;
  opacity: 0.8;
}

.stat-label {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 10px;
  color: #fff;
}

.stat-value {
  font-size: 16px;
  color: rgba(255, 255, 255, 0.8);
  margin: 0;
}

.buy-tokens-container {
  margin-bottom: 40px;
}

.buy-tokens-card {
  background: rgba(30, 40, 60, 0.5);
  border-radius: 15px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.05);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

.buy-tokens-header {
  background: rgba(0, 191, 255, 0.1);
  padding: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.buy-tokens-header h3 {
  margin: 0;
  font-size: 22px;
  color: var(--primary);
}

.buy-tokens-body {
  padding: 25px;
}

.input-with-icon {
  position: relative;
}

.input-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
}

#presaleForm input {
  padding-left: 40px;
}

.token-estimate {
  background: rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  padding: 12px 15px;
}

.estimate-content {
  display: flex;
  align-items: center;
}

.wallet-info {
  background: rgba(0, 131, 143, 0.1);
  border: 1px solid rgba(0, 131, 143, 0.2);
  border-radius: 8px;
  padding: 12px 15px;
  width: 100%;
  max-width: 400px;
}

.wallet-info-content {
  display: flex;
  align-items: center;
  justify-content: center;
}

.wallet-address {
  font-family: monospace;
  font-weight: bold;
  color: var(--primary);
}

.buy-btn {
  background: linear-gradient(135deg, #00bfff, #0088cc);
  font-weight: 600;
  margin-top: 10px;
  padding: 12px;
  font-size: 16px;
  letter-spacing: 0.5px;
  transition: all 0.3s ease;
}

.buy-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 191, 255, 0.4);
  background: linear-gradient(135deg, #00ccff, #0099dd);
}
</style>

<!-- FINESTRA AVVISO RANGE -->
<div id="rangeModal" class="range-modal">
  <div class="range-modal-content">
    <p id="rangeModalText" class="mb-3">Amount must be between 0.05 and 10 BNB.</p>
    <button class="range-modal-btn" onclick="document.getElementById('rangeModal').style.display='none';">OK</button>
  </div>
</div>

<!-- ROADMAP SECTION -->
<div class="roadmap-section py-5">
  <div class="container">
    <h2 class="section-title text-center mb-4">IASE Roadmap</h2>
    <p class="text-center mb-5">Milestones &amp; Development Stages</p>
    
    <div class="row justify-content-center mb-4">
      <div class="col-12 text-center">
        <a href="roadmap.html" class="btn btn-outline-primary mb-4">
          <i class="ri-roadmap-line me-2"></i> View Full Interactive Roadmap
        </a>
      </div>
    </div>
    
    <style>
      .compact-roadmap-item {
        border-left: 4px solid rgba(0, 191, 255, 0.3);
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
        position: relative;
        transition: all 0.3s ease;
      }
      
      .compact-roadmap-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      }
      
      .compact-roadmap-item h5 {
        margin-bottom: 0.5rem;
        position: relative;
      }
      
      .compact-roadmap-item.completed {
        border-color: #28a745;
      }
      
      .compact-roadmap-item.in-progress {
        border-color: #00bfff;
      }
      
      .compact-roadmap-item.upcoming {
        border-color: #6c757d;
      }
      
      .compact-progress {
        height: 4px;
        background-color: rgba(255, 255, 255, 0.1);
        width: 100%;
        margin-top: 0.5rem;
        border-radius: 2px;
        overflow: hidden;
      }
      
      .progress-indicator {
        height: 100%;
        border-radius: 2px;
      }
      
      .progress-completed {
        background-color: #28a745;
        width: 100%;
      }
      
      .progress-in-progress-65 {
        background-color: #00bfff;
        width: 65%;
      }
      
      .progress-in-progress-40 {
        background-color: #00bfff;
        width: 40%;
      }
      
      .progress-upcoming-10 {
        background-color: #6c757d;
        width: 10%;
      }
      
      .progress-upcoming-5 {
        background-color: #6c757d;
        width: 5%;
      }
    </style>
    
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="compact-roadmap-item completed">
          <h5>‚úì Phase 1-3: Foundation, Documentation & Token Creation (Completed)</h5>
          <p>Initial concept, whitepaper publication, and token deployment on BNB Smart Chain.</p>
          <div class="compact-progress">
            <div class="progress-indicator progress-completed"></div>
          </div>
        </div>
        
        <div class="compact-roadmap-item in-progress">
          <h5>‚Üí Phase 4: Pre-Sale & Community Growth (In Progress)</h5>
          <p>Token pre-sale and community building across platforms.</p>
          <div class="compact-progress">
            <div class="progress-indicator progress-in-progress-65"></div>
          </div>
        </div>
        
        <div class="compact-roadmap-item in-progress">
          <h5>‚Üí Phase 5: NFT Collection & Staking (In Progress)</h5>
          <p>Launch of IASE Units NFT collection with staking capabilities.</p>
          <div class="compact-progress">
            <div class="progress-indicator progress-in-progress-40"></div>
          </div>
        </div>
        
        <div class="compact-roadmap-item upcoming">
          <h5>Phase 6: Community Governance (Upcoming)</h5>
          <p>Decentralized governance implementation with community voting.</p>
          <div class="compact-progress">
            <div class="progress-indicator progress-upcoming-10"></div>
          </div>
        </div>
        
        <div class="compact-roadmap-item upcoming">
          <h5>Phase 7: IASE Simulation Framework (Upcoming)</h5>
          <p>Development of simulation architecture for space AI testing.</p>
          <div class="compact-progress">
            <div class="progress-indicator progress-upcoming-5"></div>
      </div>
    </div>
  </div>
</div>

<!-- FAQ SECTION -->
<div class="faq-section py-5">
  <div class="container">
    <h2 class="section-title text-center mb-5">IASE Token ‚Äì FAQ (Frequently Asked Questions)</h2>
    
    <div class="faq-container">
      <style>
        .faq-item {
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          padding: 1.25rem 0;
          transition: all 0.3s ease;
        }
        
        .faq-item:hover {
          background-color: rgba(0, 191, 255, 0.05);
          border-radius: 8px;
          padding-left: 1rem;
          padding-right: 1rem;
        }
        
        .faq-question {
          font-weight: 600;
          cursor: pointer;
          position: relative;
          padding-right: 30px;
          transition: all 0.3s ease;
        }
        
        .faq-question::after {
          content: '\e9c5';
          font-family: 'remixicon';
          position: absolute;
          right: 0;
          font-size: 1.25rem;
          transition: transform 0.3s;
          color: var(--primary);
        }
        
        .faq-question.active {
          color: var(--primary);
        }
        
        .faq-question.active::after {
          transform: rotate(180deg);
        }
        
        .faq-answer {
          display: none;
          margin-top: 1rem;
          line-height: 1.6;
          color: var(--text-muted);
          padding-left: 1rem;
          border-left: 2px solid var(--primary);
        }
        
        .faq-answer ul {
          margin-left: 1.5rem;
          margin-top: 0.75rem;
          margin-bottom: 0.75rem;
        }
      </style>
      
      
<div class="faq-item">
<div class="faq-question">1. How can I import the IASE Token into my wallet?</div>
<div class="faq-answer">
      MetaMask allows automatic import via the button at the top of this page.<br/><br/>
      If you are using a different wallet, you‚Äôll need to manually import the token by entering the following details:
      <ul>
<li><strong>Network:</strong> BNB Smart Chain (BSC)</li>
<li style="word-break: break-word; font-size: 14px;">
<strong>Contract Address:</strong> 0x5A170D59ae8B851DC4DD0D14cC89E5fE541752CE
</li>
<li><strong>Token Symbol:</strong> IASE</li>
<li><strong>Decimals:</strong> 18</li>
</ul>
      Open your wallet, find the ‚ÄúImport Token‚Äù or ‚ÄúAdd Custom Token‚Äù section, and enter the details above to add IASE Token to your wallet.
    </div>
</div>
<div class="faq-item">
<div class="faq-question">2. Can I participate using any wallet?</div>
<div class="faq-answer">
      Yes. You can use any BNB Chain-compatible wallet (such as MetaMask, Trust Wallet, SafePal, etc.).<br/>
      However, the automatic import feature is only supported by MetaMask.<br/>
      All wallets must support Web3 connection for the pre-sale form to function.
    </div>
</div>
<div class="faq-item">
<div class="faq-question">3. What happens if the minimum or maximum purchase limits are not respected?</div>
<div class="faq-answer">
      The system will block any transaction attempt outside the allowed range (min 0.05 BNB, max 10 BNB per wallet).<br/>
      You‚Äôll be notified instantly and prevented from proceeding until you enter a valid amount.
    </div>
</div>
<div class="faq-item">
<div class="faq-question">4. What happens after I send BNB during the pre-sale?</div>
<div class="faq-answer">
      Your IASE Tokens will be automatically sent to your wallet address after your BNB contribution is received and validated.<br/>
      Make sure to double-check your wallet is connected before submitting.
    </div>
</div>
</div>
<footer class="footer-area">
    <div class="main-footer-area">
      <div class="container">
        <div class="row justify-content-between">
          <div class="col-12 col-md-6">
            <div class="footer-widget">
              <p>¬© 2025 IASE Project ‚Äì All Rights Reserved</p>
              <div class="social-links mt-4">
                <a href="https://www.reddit.com/r/IASEproject" target="_blank" aria-label="Reddit">
                  <i class="ri-reddit-fill"></i>
                </a>
                <a href="https://medium.com/@iaseproject" target="_blank" aria-label="Medium">
                  <i class="ri-medium-fill"></i>
                </a>
                <a href="https://x.com/iase_project" target="_blank" aria-label="X (Twitter)">
                  <i class="ri-twitter-x-fill"></i>
                </a>
                <a href="https://t.me/IASEcommunity" target="_blank" aria-label="Telegram">
                  <i class="ri-telegram-fill"></i>
                </a>
              </div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="footer-widget">
              <div class="footer-links">
                <div class="d-flex justify-content-end">
                  <a href="privacy-policy.html" class="me-4">Privacy Policy</a>
                  <a href="cookie-policy.html">Cookie Policy</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>

<!-- Smart Contract Definition -->
<script>
const CONTRACT_ADDRESS = '0x5A170D59ae8B851DC4DD0D14cC89E5fE541752CE';
const ABI = [
	{
		"inputs": [
			{
				"internalType": "contract IERC20",
				"name": "_token",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "_rate",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_minBNB",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_maxBNB",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_maxPerWallet",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_endTime",
				"type": "uint256"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "withdrawUnsoldTokens",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"stateMutability": "payable",
		"type": "receive"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "contributions",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "endTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getTokenBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "maxBNB",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "maxPerWallet",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minBNB",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "rate",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "token",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
</script>

<!-- Chart.js for Tokenomics -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/************************************************
 * PARTE 1: FUNZIONI PER CONNESSIONE WALLET BSC *
 ************************************************/

// BSC Network Data
const BSC_NETWORK = {
  chainId: '0x38',
  chainName: 'BNB Smart Chain',
  nativeCurrency: {
    name: 'BNB',
    symbol: 'BNB',
    decimals: 18
  },
  rpcUrls: ['https://bsc-dataseed.binance.org/'],
  blockExplorerUrls: ['https://bscscan.com/']
};

// Check if current network is BSC
const isBscNetwork = (chainIdParam) => {
  // Se viene passato un parametro chainId, usa quello, altrimenti usa il chainId dall'oggetto window.ethereum
  const chainId = chainIdParam || (window.ethereum ? window.ethereum.chainId : null);
  
  // Log per debug
  console.log(`üîç BSC Network check: current chainId=${chainId}, BSC chainId=${BSC_NETWORK.chainId}, match=${chainId === BSC_NETWORK.chainId}`);
  
  // Se ci troviamo su BNB Smart Chain, dobbiamo vedere '0x38'
  return chainId === BSC_NETWORK.chainId;
};

// Switch to BSC Network
const switchToBscNetwork = async () => {
  if (!window.ethereum) return false;
  
  try {
    // Try to switch to BSC
    await window.ethereum.request({
      method: 'wallet_switchEthereumChain',
      params: [{ chainId: BSC_NETWORK.chainId }]
    });
    return true;
  } catch (switchError) {
    // This error code indicates that the chain has not been added to MetaMask
    if (switchError.code === 4902) {
      try {
        await window.ethereum.request({
          method: 'wallet_addEthereumChain',
          params: [BSC_NETWORK]
        });
        return true;
      } catch (addError) {
        console.error('Error adding BSC network', addError);
        return false;
      }
    }
    console.error('Error switching to BSC network', switchError);
    return false;
  }
};

// Check if wallet is really connected
const isReallyConnected = () => {
  // We need additional checks because sometimes the UI state and actual state get out of sync
  return window.ethereum && 
        window.ethereum.selectedAddress && 
        window.ethereum.selectedAddress.length > 0;
};

// Update UI based on wallet and network status
const updateTokenUI = () => {
  console.log("‚öôÔ∏è Updating token UI...");
  
  try {
    // Always check for real connection status first
    const walletConnected = isReallyConnected();
    console.log("Wallet connected:", walletConnected);
    
    if (walletConnected) {
      // Wallet is connected
      const userAddress = window.ethereum.selectedAddress;
      if (!userAddress) {
        console.log("No selectedAddress found despite wallet being connected");
        return; // Esci dalla funzione per evitare errori
      }
      
      window.userAddress = userAddress;
      const shortAddress = `${userAddress.substring(0, 6)}...${userAddress.slice(-4)}`;
      
      // Update wallet info display
      console.log("Updating wallet display for address:", shortAddress);
      
      // Make sure elements exist before trying to update them
      const shortWalletElement = document.getElementById('shortWallet');
      const walletInfoElement = document.getElementById('walletInfo');
      const connectButtonElement = document.getElementById('connectButtonBNB');
      
      if (shortWalletElement) shortWalletElement.innerText = shortAddress;
      if (walletInfoElement) walletInfoElement.style.display = 'block';
      if (connectButtonElement) connectButtonElement.style.display = 'none';
      
      try {
        // Check network and show/hide appropriate elements - in try/catch separato
        const onBscNetwork = isBscNetwork();
        console.log("On BSC network:", onBscNetwork);
        
        // Always show the wrong-network alert when not on BSC
        const wrongNetworkAlert = document.getElementById('wrong-network-alert');
        if (wrongNetworkAlert) {
          if (!onBscNetwork) {
            console.log("Showing network warning alert");
            wrongNetworkAlert.classList.remove('d-none');
          } else {
            console.log("Hiding network warning alert");
            wrongNetworkAlert.classList.add('d-none');
          }
        }
        
        // Show presale form ONLY if on BSC network
        const presaleForm = document.getElementById('presaleForm');
        if (presaleForm) {
          if (onBscNetwork) {
            console.log("Showing presale form");
            presaleForm.style.display = 'block';
            
            // Ensure form is fully initialized
            const bnbAmountElement = document.getElementById('bnbAmount');
            if (bnbAmountElement) {
              console.log("BNB amount input field is present");
            } else {
              console.error("BNB amount input field not found!");
            }
          } else {
            console.log("Hiding presale form");
            presaleForm.style.display = 'none';
          }
        } else {
          console.error("Presale form element not found!");
        }
      } catch (networkError) {
        console.error("Error checking network status:", networkError);
        // Continua con l'esecuzione per evitare di bloccare l'intera UI
      }
    } else {
      // Wallet is disconnected
      console.log("Wallet disconnected, updating UI");
      
      // Handle elements safely
      const walletInfoElement = document.getElementById('walletInfo');
      const connectButtonElement = document.getElementById('connectButtonBNB');
      
      if (walletInfoElement) walletInfoElement.style.display = 'none';
      if (connectButtonElement) connectButtonElement.style.display = 'block';
      
      // Ensure presale form is hidden
      const presaleForm = document.getElementById('presaleForm');
      if (presaleForm) {
        presaleForm.style.display = 'none';
      }
      
      // Hide wrong network alert
      const wrongNetworkAlert = document.getElementById('wrong-network-alert');
      if (wrongNetworkAlert) {
        wrongNetworkAlert.classList.add('d-none');
      }
    }
  } catch (error) {
    console.error("Error in updateTokenUI:", error);
    // Non mostrare un alert all'utente, solo log in console
    
    // Assicurare che i controlli principali siano visibili
    try {
      const walletInfoElement = document.getElementById('walletInfo');
      const connectButtonElement = document.getElementById('connectButtonBNB');
      
      if (walletInfoElement) walletInfoElement.style.display = 'none';
      if (connectButtonElement) connectButtonElement.style.display = 'block';
    } catch (e) {
      console.error("Fatal error recovering UI state:", e);
    }
  }
  
  // Schedule periodic UI updates to catch any manual disconnections
  try {
    scheduleNextUpdate();
  } catch (e) {
    console.error("Error scheduling next update:", e);
  }
};

// Periodic check to ensure UI state matches wallet state
let tokenUpdateTimer = null;
function scheduleNextUpdate() {
  console.log("üîç Scheduling ONE-TIME UI check (not recursive)");
  
  // Clear any existing timer
  if (tokenUpdateTimer) {
    clearTimeout(tokenUpdateTimer);
  }
  
  // Schedule a SINGLE check in 3 seconds (NON ricorsivo)
  tokenUpdateTimer = setTimeout(() => {
    try {
      console.log("‚è±Ô∏è Single UI check executing...");
      const walletConnected = isReallyConnected();
      const uiConnected = document.getElementById('walletInfo').style.display === 'block';
      
      // If there's a mismatch between UI and actual wallet state, update UI
      if (walletConnected !== uiConnected) {
        console.log('‚ö†Ô∏è UI wallet state mismatch detected, correcting...');
        updateTokenUI();
      } else {
        console.log('‚úÖ UI state matches wallet state, no action needed');
      }
      
      // NON scheduliamo un nuovo check automaticamente qui!
      // scheduleNextUpdate() NO PI√ô CHIAMATO QUI - BLOCCA IL LOOP INFINITO
    } catch (err) {
      console.error("‚ùå Error during wallet UI check:", err);
    }
  }, 3000);
  
  console.log("üïí Single UI check scheduled for 3 seconds from now");
};

// Connessione wallet BNB
const connectWalletBNB = async () => {
  console.log("üîå Connect BNB Wallet function called");
  
  // Disabilita il pulsante di connessione e mostra lo spinner
  const connectBtn = document.getElementById('connectButtonBNB');
  if (connectBtn) {
    connectBtn.disabled = true;
    connectBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span> Connecting...';
  }
  
  // Mostra messaggio utente in attesa della connessione
  const connectingMessage = document.createElement('div');
  connectingMessage.id = 'connecting-message';
  connectingMessage.style.position = 'fixed';
  connectingMessage.style.bottom = '20px';
  connectingMessage.style.right = '20px';
  connectingMessage.style.backgroundColor = '#2c3e50';
  connectingMessage.style.color = 'white';
  connectingMessage.style.padding = '10px 15px';
  connectingMessage.style.borderRadius = '5px';
  connectingMessage.style.zIndex = '9999';
  connectingMessage.innerHTML = 'Connecting to wallet... <div class="spinner-border spinner-border-sm text-light" role="status"></div>';
  document.body.appendChild(connectingMessage);
  
  // Verifica se MetaMask √® installato
  if (!window.ethereum) {
    console.error("MetaMask not detected");
    
    // Rimuovi il messaggio di connessione
    const msgElement = document.getElementById('connecting-message');
    if (msgElement) document.body.removeChild(msgElement);
    
    // Ripristina il pulsante
    if (connectBtn) {
      connectBtn.disabled = false;
      connectBtn.innerHTML = '<i class="ri-wallet-3-line me-2"></i> Connect BNB Wallet';
    }
    
    // Mostra messaggio di errore
    alert("Please install MetaMask to use this feature. Visit https://metamask.io");
    return;
  }
  
  try {
    console.log("Requesting accounts from MetaMask...");
    
    // Request accounts from MetaMask
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    console.log("Accounts received:", accounts);
    
    // Verificare che l'utente abbia effettivamente concesso i permessi
    if (!accounts || accounts.length === 0) {
      console.log("No accounts received, user may have rejected the request");
      
      // Rimuovi il messaggio di connessione
      const msgElement = document.getElementById('connecting-message');
      if (msgElement) document.body.removeChild(msgElement);
      
      // Ripristina il pulsante
      if (connectBtn) {
        connectBtn.disabled = false;
        connectBtn.innerHTML = '<i class="ri-wallet-3-line me-2"></i> Connect BNB Wallet';
      }
      
      return;
    }
    
    // Check if we're on the right network and offer to switch if not
    if (!isBscNetwork()) {
      console.log("Not on BSC network, prompting to switch...");
      const switched = await switchToBscNetwork();
      console.log("Network switch result:", switched);
    }
    
    // Aggiorna UI per mostrare lo stato connesso
    updateTokenUI();
    
    // Configura listeners per cambiamenti di rete e account
    window.ethereum.on('chainChanged', () => {
      console.log("üîÑ Chain changed, updating UI");
      updateTokenUI();
    });
    
    window.ethereum.on('accountsChanged', (newAccounts) => {
      console.log("üîÑ Accounts changed:", newAccounts);
      if (newAccounts.length === 0) {
        console.log("User disconnected wallet");
      }
      updateTokenUI();
    });
    
    // Rimuovi il messaggio di connessione
    const msgElement = document.getElementById('connecting-message');
    if (msgElement) document.body.removeChild(msgElement);
    
  } catch (error) {
    console.error("Error connecting wallet:", error);
    
    // Rimuovi il messaggio di connessione
    const msgElement = document.getElementById('connecting-message');
    if (msgElement) document.body.removeChild(msgElement);
    
    // Ripristina il pulsante
    if (connectBtn) {
      connectBtn.disabled = false;
      connectBtn.innerHTML = '<i class="ri-wallet-3-line me-2"></i> Connect BNB Wallet';
    }
    
    // Mostra messaggio di errore
    if (error.code === 4001) {
      // User rejected the request
      console.log("User rejected connection request");
    } else {
      alert("Error connecting to wallet. Please try again.");
    }
  }
};


/************************************************
 * PARTE 2: FUNZIONI PER FORM TOKEN             *
 ************************************************/

// Costanti per il form
const conversionRate = 1000000; // 1 BNB = 1,000,000 IASE
const minBNB = 0.05;
const maxBNB = 10;

// Mostra finestra range personalizzata
const showRangeModal = (msg) => {
  document.getElementById('rangeModalText').innerText = msg;
  document.getElementById('rangeModal').style.display = 'block';
};

// Handler input BNB
function handleBnbInputChange() {
  const bnbInput = document.getElementById('bnbAmount');
  const estimateDiv = document.getElementById('estimate');
  const estimateText = document.getElementById('estimateText');
  
  // Controlla validit√† input
  const bnb = parseFloat(bnbInput.value.replace(",", "."));
  
  if (estimateDiv && estimateText) {
    estimateDiv.style.display = 'block';
    estimateDiv.style.background = 'rgba(0, 0, 0, 0.1)';
    estimateDiv.style.border = '1px solid rgba(255, 255, 255, 0.1)';
    
    if (!isNaN(bnb) && bnb >= minBNB && bnb <= maxBNB) {
      const iase = bnb * conversionRate;
      estimateText.innerHTML = `You will receive: <strong>${iase.toLocaleString()} IASE</strong>`;
    } else if (bnb > maxBNB) {
      estimateText.innerHTML = `<span style="color: #ff6b6b;">Max limit is ${maxBNB} BNB</span>`;
    } else if (bnb < minBNB) {
      estimateText.innerHTML = `<span style="color: #ff6b6b;">Min limit is ${minBNB} BNB</span>`;
    }
  }
}

// Validazione form
function validateTokenForm(e) {
  const amount = parseFloat(document.getElementById('bnbAmount').value.replace(",", "."));
  if (isNaN(amount) || amount < minBNB || amount > maxBNB) {
    e.preventDefault(); // Evita che il form HTML5 blocchi o resetti
    showRangeModal(`Please enter a valid amount between ${minBNB} and ${maxBNB} BNB.`);
    return false;
  }
  return true;
}

// Invio token form
async function submitTokenForm(e) {
  e.preventDefault();

  // Validazione input
  const amount = parseFloat(document.getElementById('bnbAmount').value.replace(",", "."));
  if (isNaN(amount) || amount < minBNB || amount > maxBNB) {
    showRangeModal(`Please enter a valid amount between ${minBNB} and ${maxBNB} BNB.`);
    return;
  }

  const web3 = new Web3(window.ethereum);
  const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);

  try {
    const tx = await contract.methods.buyTokens().send({
      from: window.userAddress,
      value: web3.utils.toWei(amount.toString(), 'ether')
    });

    // Mostra notifica di successo
    const estimateDiv = document.getElementById('estimate');
    const estimateText = document.getElementById('estimateText');
    
    estimateDiv.style.display = 'block';
    estimateDiv.style.background = 'rgba(0, 150, 136, 0.15)';
    estimateDiv.style.border = '1px solid rgba(0, 150, 136, 0.3)';
    
    estimateText.innerHTML = `<i class="ri-check-double-line me-2" style="color: #00e676;"></i> <span style="color: #00e676; font-weight: 600;">Purchase completed! Tokens have been sent.</span>`;

    // Chiudi modale e resetta campo input
    document.getElementById("rangeModal").style.display = "none";
    document.getElementById("bnbAmount").value = "";

    // Reset UI
    document.getElementById('walletInfo').style.display = 'block';
    document.getElementById('connectButtonBNB').style.display = 'none';
    document.getElementById('presaleForm').style.display = 'block';

  } catch (error) {
    console.error("Transaction error:", error);

    // Messaggio errore
    document.getElementById("rangeModal").style.display = "none";
    document.body.style.overflow = 'auto';

    // Mostra errore sulla UI
    const estimateDiv = document.getElementById('estimate');
    const estimateText = document.getElementById('estimateText');
    
    estimateDiv.style.display = 'block';
    estimateDiv.style.background = 'rgba(244, 67, 54, 0.1)';
    estimateDiv.style.border = '1px solid rgba(244, 67, 54, 0.3)';
    
    estimateText.innerHTML = `<i class="ri-error-warning-line me-2" style="color: #ff5252;"></i> <span style="color: #ff5252; font-weight: 600;">Transaction failed. Please try again.</span>`;
  }
}

// Initialize Tokenomics Chart
function initTokenomicsChart() {
  const ctx = document.getElementById('tokenomicsChart');
  if (!ctx) return;
  
  // Token distribution data 
  // Dati esatti dal whitepaper
  const tokenomicsData = {
    presale: 15,         // 150,000,000 IASE
    liquidity: 20,        // 200,000,000 IASE
    staking: 25,          // 250,000,000 IASE
    teamDev: 15,          // 150,000,000 IASE
    ecosystem: 15,        // 150,000,000 IASE
    reserve: 10           // 100,000,000 IASE
  };
  
  // Update HTML values
  document.getElementById('presaleValue').textContent = tokenomicsData.presale + '%';
  document.getElementById('liquidityValue').textContent = tokenomicsData.liquidity + '%';
  document.getElementById('stakingValue').textContent = tokenomicsData.staking + '%';
  document.getElementById('teamValue').textContent = tokenomicsData.teamDev + '%';
  document.getElementById('ecosystemValue').textContent = tokenomicsData.ecosystem + '%';
  document.getElementById('reserveValue').textContent = tokenomicsData.reserve + '%';
  
  // Chart configuration
  const tokenomicsChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: [
        'Pre-sale',
        'Liquidity Pool',
        'Staking Rewards',
        'Team & Development',
        'Ecosystem & Partnerships',
        'Reserve'
      ],
      datasets: [{
        data: [
          tokenomicsData.presale,
          tokenomicsData.liquidity,
          tokenomicsData.staking,
          tokenomicsData.teamDev,
          tokenomicsData.ecosystem,
          tokenomicsData.reserve
        ],
        backgroundColor: [
          'rgba(0, 191, 255, 0.8)',
          'rgba(75, 192, 192, 0.8)',
          'rgba(153, 102, 255, 0.8)',
          'rgba(255, 159, 64, 0.8)',
          'rgba(255, 99, 132, 0.8)',
          'rgba(54, 162, 235, 0.8)'
        ],
        borderColor: 'rgba(0, 0, 0, 0.1)',
        borderWidth: 2,
        hoverOffset: 15
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      cutout: '70%',
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.label || '';
              const value = context.parsed || 0;
              return `${label}: ${value}%`;
            }
          },
          backgroundColor: 'rgba(0, 0, 0, 0.7)',
          titleColor: 'rgba(0, 191, 255, 1)',
          bodyColor: '#fff',
          borderColor: 'rgba(0, 191, 255, 0.3)',
          borderWidth: 1,
          padding: 10,
          displayColors: true
        }
      }
    }
  });
}

/************************************************
 * PARTE 3: INIZIALIZZAZIONE DOCUMENT-READY     *
 ************************************************/

// Inizializzazione pagina
document.addEventListener('DOMContentLoaded', function() {
  console.log("üîÑ Inizializzazione pagina token...");

  // Initialize tokenomics chart
  initTokenomicsChart();

  // Controlla se il pulsante esiste
  const connectBtnBNB = document.getElementById('connectButtonBNB');
  if (connectBtnBNB) {
    console.log("‚úÖ Pulsante connectButtonBNB trovato, aggiungo event listener");
    
    // Aggiungi event listener al pulsante di connessione
    connectBtnBNB.addEventListener('click', function() {
      console.log("üñ±Ô∏è Clic sul pulsante connectButtonBNB rilevato");
      connectWalletBNB();
    });
  } else {
    console.error("‚ùå Pulsante connectButtonBNB non trovato nel DOM!");
  }
  
  // Event listener per BNB input
  const bnbAmountInput = document.getElementById('bnbAmount');
  if (bnbAmountInput) {
    bnbAmountInput.addEventListener('input', handleBnbInputChange);
    
    // Blocco tasto INVIO fuori range
    bnbAmountInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        const amount = parseFloat(this.value.replace(",", "."));
        if (isNaN(amount) || amount < minBNB || amount > maxBNB) {
          showRangeModal(`Please enter a valid amount between ${minBNB} and ${maxBNB} BNB.`);
          return false;
        }
      }
    });
  }
  
  // Event listener per form submit button
  const submitBtn = document.querySelector('#presaleForm button[type="submit"]');
  if (submitBtn) {
    submitBtn.addEventListener('click', validateTokenForm);
  }
  
  // Event listener per form submit
  const presaleForm = document.getElementById('presaleForm');
  if (presaleForm) {
    presaleForm.addEventListener('submit', submitTokenForm);
  }
  
  // Aggiorna UI una volta all'avvio
  try {
    console.log("üîÑ Aggiornamento iniziale UI token...");
    updateTokenUI();
  } catch (e) {
    console.error("‚ùå Errore nell'aggiornamento iniziale UI:", e);
  }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@1.8.0/dist/web3.min.js"></script>
<script src="js/webp-detect.js"></script>
<script src="js/image-loader.js"></script>
<script src="js/space-background.js"></script>
<script src="js/parallax.js"></script>
<script src="script.js"></script>

</body>
</html>